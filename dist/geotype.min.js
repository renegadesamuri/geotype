"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))((function(i,s){function n(e){try{d(a.next(e))}catch(e){s(e)}}function r(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,r)}d((a=a.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GoogleMapsService=void 0;class GoogleMapsService{constructor(e){this.isLoaded=!1,this.loadCallbacks=[],this.markers=[],this.apiKey=e.apiKey,this.options=Object.assign({version:e.version||"weekly",libraries:e.libraries||["places"],language:e.language||"en",region:e.region,callback:e.callback||"initMap"},e),this.options.callback&&"undefined"!=typeof window&&(window[this.options.callback]=()=>{this.isLoaded=!0,this.loadCallbacks.forEach((e=>e())),this.loadCallbacks=[]})}loadApi(){return new Promise(((e,t)=>{var o;if("undefined"==typeof window)return void t(new Error("Google Maps can only be loaded in browser environment"));if(this.isLoaded)return void e();this.loadCallbacks.push((()=>e()));if(document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]'))return;const a=document.createElement("script"),i=null===(o=this.options.libraries)||void 0===o?void 0:o.join(",");a.src=`https://maps.googleapis.com/maps/api/js?key=${this.apiKey}&v=${this.options.version}${i?`&libraries=${i}`:""}${this.options.language?`&language=${this.options.language}`:""}${this.options.region?`&region=${this.options.region}`:""}${this.options.callback?`&callback=${this.options.callback}`:""}`,a.async=!0,a.defer=!0,a.onerror=()=>{t(new Error("Google Maps script failed to load"))},document.head.appendChild(a),this.options.callback||(a.onload=()=>{this.isLoaded=!0,e()})}))}initMap(e,t){return __awaiter(this,void 0,void 0,(function*(){this.isLoaded||(yield this.loadApi());const o="string"==typeof e?document.getElementById(e):e;if(!o)throw new Error(`Map element not found: ${e}`);const a=Object.assign(Object.assign({},t),{center:new google.maps.LatLng(t.center.lat,t.center.lng)});return this.mapInstance=new google.maps.Map(o,a),this.mapInstance}))}getMap(){return this.mapInstance}createMarker(e){if(!this.mapInstance)throw new Error("Map must be initialized before creating markers");const t=new google.maps.Marker(Object.assign(Object.assign({},e),{map:this.mapInstance}));return this.markers.push(t),t}removeMarker(e){e.setMap(null),this.markers=this.markers.filter((t=>t!==e))}clearMarkers(){this.markers.forEach((e=>e.setMap(null))),this.markers=[]}geocodeAddress(e){return __awaiter(this,void 0,void 0,(function*(){return yield this.ensureApiLoaded(),new Promise(((t,o)=>{(new google.maps.Geocoder).geocode({address:e},((a,i)=>{if(i===google.maps.GeocoderStatus.OK&&a&&a.length>0){const o=a.map((t=>{var o;return{address:e,location:{lat:t.geometry.location.lat(),lng:t.geometry.location.lng()},placeId:t.place_id,formattedAddress:t.formatted_address,addressComponents:null===(o=t.address_components)||void 0===o?void 0:o.map((e=>({longName:e.long_name,shortName:e.short_name,types:e.types})))}}));t(o)}else o(new Error(`Geocoding failed: ${i}`))}))}))}))}reverseGeocode(e,t){return __awaiter(this,void 0,void 0,(function*(){return yield this.ensureApiLoaded(),new Promise(((o,a)=>{const i=new google.maps.Geocoder,s={lat:e,lng:t};i.geocode({location:s},((i,s)=>{if(s===google.maps.GeocoderStatus.OK&&i&&i.length>0){const a=i.map((o=>{var a;return{address:o.formatted_address,location:{lat:e,lng:t},placeId:o.place_id,formattedAddress:o.formatted_address,addressComponents:null===(a=o.address_components)||void 0===a?void 0:a.map((e=>({longName:e.long_name,shortName:e.short_name,types:e.types})))}}));o(a)}else a(new Error(`Reverse geocoding failed: ${s}`))}))}))}))}addMarker(e){return __awaiter(this,void 0,void 0,(function*(){if(yield this.ensureApiLoaded(),!this.mapInstance&&void 0===e.map)throw new Error("No map instance available. Initialize a map first or provide a map in options.");const t=Object.assign(Object.assign({},e),{map:e.map||this.mapInstance});return new google.maps.Marker(t)}))}getDirections(e,t){return __awaiter(this,arguments,void 0,(function*(e,t,o={}){yield this.ensureApiLoaded();const a=new google.maps.DirectionsService,i=Object.assign({origin:e,destination:t,travelMode:google.maps.TravelMode.DRIVING},o);return new Promise(((e,t)=>{a.route(i,((o,a)=>{a===google.maps.DirectionsStatus.OK?e(o):t(new Error(`Directions request failed: ${a}`))}))}))}))}displayDirections(e){return __awaiter(this,arguments,void 0,(function*(e,t={}){if(yield this.ensureApiLoaded(),!this.mapInstance&&void 0===t.map)throw new Error("No map instance available. Initialize a map first or provide a map in options.");const o=Object.assign({map:t.map||this.mapInstance},t),a=new google.maps.DirectionsRenderer(o);return a.setDirections(e),a}))}createAutocomplete(e){return __awaiter(this,arguments,void 0,(function*(e,t={}){yield this.ensureApiLoaded();const o="string"==typeof e?document.getElementById(e):e;if(!o)throw new Error(`Input element not found: ${e}`);return new google.maps.places.Autocomplete(o,t)}))}getPlaceDetails(e){return __awaiter(this,arguments,void 0,(function*(e,t=["address_components","geometry","name","formatted_address"]){yield this.ensureApiLoaded();const o=new google.maps.places.PlacesService(this.mapInstance||document.createElement("div"));return new Promise(((a,i)=>{o.getDetails({placeId:e,fields:t},((e,t)=>{t===google.maps.places.PlacesServiceStatus.OK&&e?a(e):i(new Error(`Place details request failed: ${t}`))}))}))}))}ensureApiLoaded(){return __awaiter(this,void 0,void 0,(function*(){this.isLoaded||(yield this.loadApi())}))}}exports.GoogleMapsService=GoogleMapsService;